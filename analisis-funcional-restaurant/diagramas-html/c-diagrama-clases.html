<!DOCTYPE html>
<html>
<head>
    <title>Diagrama de Clases</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default'
        });
    </script>
    <style>
        .mermaid {
            text-align: center;
            margin: 20px;
        }
    </style>
</head>
<body>
<div class="mermaid">
    classDiagram
    class Usuario {
    -int usuarioId
    -string email
    -string nombre
    -string telefono
    -string passwordHash
    -DateTime fechaRegistro
    -boolean activo
    +autenticar()
    +actualizarPerfil()
    +cambiarPassword()
    }

    class Cliente {
    -List direcciones
    -List historialPedidos
    +agregarDireccion()
    +obtenerDireccionPredeterminada()
    +realizarPedido()
    +consultarHistorial()
    }

    class Empleado {
    -string rol
    -int sucursalId
    -DateTime fechaContratacion
    +tienePermiso()
    +cambiarSucursal()
    }

    class Repartidor {
    -string vehiculoTipo
    -string placaVehiculo
    -boolean disponible
    -Ubicacion ubicacionActual
    +actualizarUbicacion()
    +aceptarPedido()
    +marcarEntregaCompletada()
    }

    class Categoria {
    -int categoriaId
    -string nombre
    -string descripcion
    -boolean activa
    +activar()
    +desactivar()
    }

    class Producto {
    -int productoId
    -int categoriaId
    -string nombre
    -string descripcion
    -decimal precioBase
    -string imagenUrl
    -boolean activo
    +actualizarPrecio()
    +estaDisponible()
    +obtenerPrecio()
    }

    class ProductoSucursal {
    -int productoSucursalId
    -int productoId
    -int sucursalId
    -decimal precioLocal
    -int stockDisponible
    -boolean disponible
    +actualizarStock()
    +verificarDisponibilidad()
    +aplicarOferta()
    }

    class Carrito {
    -List items
    -decimal subtotal
    -int sucursalId
    +agregarItem()
    +removerItem()
    +calcularTotal()
    +aplicarPromocion()
    +vaciar()
    }

    class ItemCarrito {
    -int productoId
    -string nombreProducto
    -int cantidad
    -decimal precioUnitario
    -decimal subtotal
    +actualizarCantidad()
    +calcularSubtotal()
    }

    class Pedido {
    -int pedidoId
    -string numeroPedido
    -int clienteId
    -int sucursalId
    -DateTime fechaPedido
    -string estado
    -decimal total
    -string notasCliente
    +confirmar()
    +cancelar()
    +actualizarEstado()
    +calcularTiempoEntrega()
    }

    class DetallePedido {
    -int detalleId
    -int productoId
    -int cantidad
    -decimal precioUnitario
    -decimal subtotal
    +calcularSubtotal()
    +modificarCantidad()
    }

    class Sucursal {
    -int sucursalId
    -string nombre
    -string telefono
    -boolean activa
    -int radioEntregaKm
    +estaAbierta()
    +estaEnZonaEntrega()
    +obtenerProductosDisponibles()
    +asignarRepartidor()
    }

    class Direccion {
    -int direccionId
    -string calle
    -string numero
    -string colonia
    -string ciudad
    -string codigoPostal
    -float latitud
    -float longitud
    +calcularDistancia()
    +validarFormato()
    +obtenerTextoCompleto()
    }

    class Pago {
    -int pagoId
    -int pedidoId
    -string metodoPago
    -decimal monto
    -string estado
    -DateTime fechaProcesamiento
    +procesar()
    +reembolsar()
    +verificarEstado()
    }

    class Promocion {
    -int promocionId
    -string nombre
    -string descripcion
    -string tipo
    -decimal valorDescuento
    -decimal montoMinimo
    -Date fechaInicio
    -Date fechaFin
    -boolean activa
    +estaVigente()
    +esAplicable()
    +calcularDescuento()
    }

    %% Relaciones de Herencia
    Usuario <|-- Cliente
    Usuario <|-- Empleado
    Empleado <|-- Repartidor

    %% Relaciones principales
    Cliente --> Direccion
    Cliente --> Pedido
    Carrito --> ItemCarrito
    Pedido --> DetallePedido
    Pedido --> Pago
    Pedido --> Sucursal
    Pedido --> Direccion
    Pedido --> Cliente
    Sucursal --> Empleado
    Sucursal --> Repartidor
    Categoria --> Producto
    Producto --> ProductoSucursal
    Sucursal --> ProductoSucursal
    Repartidor --> Pedido
</div>
</body>
</html>