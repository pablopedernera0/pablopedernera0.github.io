<!DOCTYPE html>
<html>
<head>
    <title>Diagrama de Casos de Uso Interactivo</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.6.1/mermaid.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .controls {
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .control-group label {
            font-weight: bold;
            color: #495057;
        }

        .zoom-controls button {
            padding: 8px 12px;
            margin: 0 2px;
            border: none;
            background: #007bff;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .zoom-controls button:hover {
            background: #0056b3;
        }

        .zoom-controls button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }

        .filter-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .filter-btn {
            padding: 6px 12px;
            border: 2px solid #dee2e6;
            background: white;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
        }

        .filter-btn.active {
            border-color: #007bff;
            background: #007bff;
            color: white;
        }

        .diagram-container {
            position: relative;
            overflow: auto;
            height: 80vh;
            background: white;
        }

        .diagram-wrapper {
            transform-origin: top left;
            transition: transform 0.3s ease;
            min-width: 100%;
            min-height: 100%;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 20px;
        }

        .zoom-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
        }

        .legend {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255,255,255,0.95);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            max-width: 250px;
            font-size: 12px;
        }

        .legend h4 {
            margin: 0 0 10px 0;
            color: #495057;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin: 5px 0;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 3px;
            margin-right: 8px;
            border: 1px solid #ccc;
        }

        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .filter-buttons {
                justify-content: center;
            }

            .legend {
                position: relative;
                margin: 10px;
                max-width: none;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>üçî Sistema de Pedidos a Domicilio - Casos de Uso</h1>
        <p>Diagrama interactivo con zoom y filtros por actor</p>
    </div>

    <div class="controls">
        <div class="control-group">
            <label>Zoom:</label>
            <div class="zoom-controls">
                <button onclick="zoomOut()" id="zoomOutBtn">‚ûñ</button>
                <button onclick="resetZoom()">üéØ</button>
                <button onclick="zoomIn()" id="zoomInBtn">‚ûï</button>
            </div>
        </div>

        <div class="control-group">
            <label>Filtrar por actor:</label>
            <div class="filter-buttons">
                <div class="filter-btn active" onclick="filterActor('all')">Todos</div>
                <div class="filter-btn" onclick="filterActor('cliente')">üë§ Cliente</div>
                <div class="filter-btn" onclick="filterActor('repartidor')">üöó Repartidor</div>
                <div class="filter-btn" onclick="filterActor('cocina')">üë®‚Äçüç≥ Cocina</div>
                <div class="filter-btn" onclick="filterActor('admin-sucursal')">üëî Admin Sucursal</div>
                <div class="filter-btn" onclick="filterActor('admin-sistema')">üíª Admin Sistema</div>
            </div>
        </div>
    </div>

    <div class="diagram-container" id="diagramContainer">
        <div class="zoom-indicator" id="zoomIndicator">100%</div>
        <div class="legend">
            <h4>Leyenda</h4>
            <div class="legend-item">
                <div class="legend-color" style="background: #e8f5e8; border-color: #2e7d32;"></div>
                <span>Cliente</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #f3e5f5; border-color: #7b1fa2;"></div>
                <span>Repartidor</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #fff3e0; border-color: #ef6c00;"></div>
                <span>Cocina</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #e0f2f1; border-color: #00695c;"></div>
                <span>Admin Sucursal</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #fff8e1; border-color: #f57f17;"></div>
                <span>Admin Sistema</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #fce4ec; border-color: #ad1457;"></div>
                <span>Integraciones</span>
            </div>
        </div>

        <div class="diagram-wrapper" id="diagramWrapper">
            <div id="mermaidDiagram"></div>
        </div>
    </div>
</div>

<script>
    let currentZoom = 1;
    let currentFilter = 'all';

    const zoomStep = 0.2;
    const minZoom = 0.5;
    const maxZoom = 3;

    // Configurar Mermaid
    mermaid.initialize({
        startOnLoad: false,
        theme: 'default',
        flowchart: {
            useMaxWidth: false,
            htmlLabels: true,
            curve: 'cardinal'
        }
    });

    // Diagramas por actor
    const diagrams = {
        all: `
                flowchart TD
                    Cliente[üë§ Cliente]
                    Repartidor[üöó Repartidor]
                    Cocina[üë®‚Äçüç≥ Empleado Cocina]
                    AdminSucursal[üëî Admin Sucursal]
                    AdminSistema[üíª Admin Sistema]
                    SistemaPOS[üñ•Ô∏è Sistema POS]
                    SistemaPagos[üí≥ Sistema Pagos]

                    subgraph ClienteUC["Gesti√≥n de Cliente"]
                        UC01[Registrarse]
                        UC02[Iniciar Sesi√≥n]
                        UC03[Gestionar Perfil]
                        UC04[Gestionar Direcciones]
                        UC05[Consultar Historial]
                    end

                    subgraph PedidosUC["Gesti√≥n de Pedidos"]
                        UC06[Navegar Men√∫]
                        UC07[Agregar al Carrito]
                        UC08[Aplicar Promoci√≥n]
                        UC09[Realizar Pedido]
                        UC10[Realizar Pago]
                        UC11[Seguir Pedido]
                        UC12[Cancelar Pedido]
                        UC13[Calificar Servicio]
                    end

                    Cliente -.-> UC01
                    Cliente -.-> UC02
                    Cliente -.-> UC03
                    Cliente -.-> UC04
                    Cliente -.-> UC05
                    Cliente -.-> UC06
                    Cliente -.-> UC07
                    Cliente -.-> UC08
                    Cliente -.-> UC09
                    Cliente -.-> UC10
                    Cliente -.-> UC11
                    Cliente -.-> UC12
                    Cliente -.-> UC13

                    classDef actorStyle fill:#e1f5fe,stroke:#01579b,stroke-width:2px
                    classDef clienteUC fill:#e8f5e8,stroke:#2e7d32,stroke-width:1px

                    class Cliente,Repartidor,Cocina,AdminSucursal,AdminSistema actorStyle
                    class UC01,UC02,UC03,UC04,UC05,UC06,UC07,UC08,UC09,UC10,UC11,UC12,UC13 clienteUC
            `,
        cliente: `
                flowchart TD
                    Cliente[üë§ Cliente]
                    SistemaPagos[üí≥ Sistema Pagos]

                    subgraph ClienteUC["üîê Gesti√≥n de Cliente"]
                        UC01[Registrarse]
                        UC02[Iniciar Sesi√≥n]
                        UC03[Gestionar Perfil]
                        UC04[Gestionar Direcciones]
                        UC05[Consultar Historial]
                    end

                    subgraph PedidosUC["üõí Gesti√≥n de Pedidos"]
                        UC06[Navegar Men√∫]
                        UC07[Agregar al Carrito]
                        UC08[Aplicar Promoci√≥n]
                        UC09[Realizar Pedido]
                        UC10[Realizar Pago]
                        UC11[Seguir Pedido]
                        UC12[Cancelar Pedido]
                        UC13[Calificar Servicio]
                    end

                    Cliente -.-> UC01
                    Cliente -.-> UC02
                    Cliente -.-> UC03
                    Cliente -.-> UC04
                    Cliente -.-> UC05
                    Cliente -.-> UC06
                    Cliente -.-> UC07
                    Cliente -.-> UC08
                    Cliente -.-> UC09
                    Cliente -.-> UC10
                    Cliente -.-> UC11
                    Cliente -.-> UC12
                    Cliente -.-> UC13

                    UC09 --> UC10
                    UC10 --> SistemaPagos
                    UC09 -.-> UC08

                    classDef actorStyle fill:#e1f5fe,stroke:#01579b,stroke-width:3px
                    classDef sistemaStyle fill:#ffebee,stroke:#c62828,stroke-width:2px
                    classDef clienteUC fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px

                    class Cliente actorStyle
                    class SistemaPagos sistemaStyle
                    class UC01,UC02,UC03,UC04,UC05,UC06,UC07,UC08,UC09,UC10,UC11,UC12,UC13 clienteUC
            `,
        repartidor: `
                flowchart TD
                    Repartidor[üöó Repartidor]

                    subgraph RepartidorUC["üöö Gesti√≥n de Entregas"]
                        UC14[Ver Pedidos Asignados]
                        UC15[Aceptar/Rechazar Entrega]
                        UC16[Actualizar Ubicaci√≥n]
                        UC17[Confirmar Recogida]
                        UC18[Confirmar Entrega]
                        UC19[Reportar Problema]
                    end

                    subgraph IntegracionUC["üîß Integraciones"]
                        UC42[Enviar Notificaciones]
                        UC44[Calcular Ruta √ìptima]
                    end

                    Repartidor -.-> UC14
                    Repartidor -.-> UC15
                    Repartidor -.-> UC16
                    Repartidor -.-> UC17
                    Repartidor -.-> UC18
                    Repartidor -.-> UC19

                    UC15 --> UC44
                    UC18 --> UC42

                    classDef actorStyle fill:#e1f5fe,stroke:#01579b,stroke-width:3px
                    classDef repartidorUC fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
                    classDef integracionUC fill:#fce4ec,stroke:#ad1457,stroke-width:2px

                    class Repartidor actorStyle
                    class UC14,UC15,UC16,UC17,UC18,UC19 repartidorUC
                    class UC42,UC44 integracionUC
            `,
        cocina: `
                flowchart TD
                    Cocina[üë®‚Äçüç≥ Empleado Cocina]

                    subgraph CocinaUC["üç≥ Gesti√≥n de Cocina"]
                        UC20[Ver Pedidos Pendientes]
                        UC21[Iniciar Preparaci√≥n]
                        UC22[Actualizar Estado Pedido]
                        UC23[Marcar Pedido Listo]
                        UC24[Reportar Demora]
                    end

                    subgraph IntegracionUC["üì± Notificaciones"]
                        UC42[Enviar Notificaciones]
                    end

                    Cocina -.-> UC20
                    Cocina -.-> UC21
                    Cocina -.-> UC22
                    Cocina -.-> UC23
                    Cocina -.-> UC24

                    UC22 -.-> UC24
                    UC23 --> UC42

                    classDef actorStyle fill:#e1f5fe,stroke:#01579b,stroke-width:3px
                    classDef cocinaUC fill:#fff3e0,stroke:#ef6c00,stroke-width:2px
                    classDef integracionUC fill:#fce4ec,stroke:#ad1457,stroke-width:2px

                    class Cocina actorStyle
                    class UC20,UC21,UC22,UC23,UC24 cocinaUC
                    class UC42 integracionUC
            `,
        "admin-sucursal": `
                flowchart TD
                    AdminSucursal[üëî Admin Sucursal]
                    SistemaPOS[üñ•Ô∏è Sistema POS]

                    subgraph AdminSucursalUC["üè™ Administraci√≥n Sucursal"]
                        UC25[Gestionar Men√∫ Local]
                        UC26[Actualizar Precios]
                        UC27[Gestionar Stock]
                        UC28[Ver Reportes Sucursal]
                        UC29[Gestionar Empleados]
                        UC30[Configurar Horarios]
                        UC31[Gestionar Repartidores]
                        UC32[Crear Promociones Locales]
                    end

                    subgraph IntegracionUC["üîÑ Sincronizaci√≥n"]
                        UC40[Sincronizar Inventario]
                    end

                    AdminSucursal -.-> UC25
                    AdminSucursal -.-> UC26
                    AdminSucursal -.-> UC27
                    AdminSucursal -.-> UC28
                    AdminSucursal -.-> UC29
                    AdminSucursal -.-> UC30
                    AdminSucursal -.-> UC31
                    AdminSucursal -.-> UC32

                    UC25 --> UC40
                    UC27 --> UC40
                    UC40 --> SistemaPOS

                    classDef actorStyle fill:#e1f5fe,stroke:#01579b,stroke-width:3px
                    classDef sistemaStyle fill:#ffebee,stroke:#c62828,stroke-width:2px
                    classDef adminSucursalUC fill:#e0f2f1,stroke:#00695c,stroke-width:2px
                    classDef integracionUC fill:#fce4ec,stroke:#ad1457,stroke-width:2px

                    class AdminSucursal actorStyle
                    class SistemaPOS sistemaStyle
                    class UC25,UC26,UC27,UC28,UC29,UC30,UC31,UC32 adminSucursalUC
                    class UC40 integracionUC
            `,
        "admin-sistema": `
                flowchart TD
                    AdminSistema[üíª Admin Sistema]

                    subgraph AdminSistemaUC["‚öôÔ∏è Administraci√≥n Sistema"]
                        UC33[Gestionar Sucursales]
                        UC34[Gestionar Usuarios]
                        UC35[Configurar Sistema]
                        UC36[Ver Reportes Globales]
                        UC37[Gestionar Promociones]
                        UC38[Monitorear Performance]
                        UC39[Gestionar Integraciones]
                    end

                    AdminSistema -.-> UC33
                    AdminSistema -.-> UC34
                    AdminSistema -.-> UC35
                    AdminSistema -.-> UC36
                    AdminSistema -.-> UC37
                    AdminSistema -.-> UC38
                    AdminSistema -.-> UC39

                    classDef actorStyle fill:#e1f5fe,stroke:#01579b,stroke-width:3px
                    classDef adminSistemaUC fill:#fff8e1,stroke:#f57f17,stroke-width:2px

                    class AdminSistema actorStyle
                    class UC33,UC34,UC35,UC36,UC37,UC38,UC39 adminSistemaUC
            `
    };

    function renderDiagram(diagramCode) {
        const element = document.getElementById('mermaidDiagram');
        element.innerHTML = '';

        mermaid.render('diagram', diagramCode).then(result => {
            element.innerHTML = result.svg;
        }).catch(error => {
            console.error('Error rendering diagram:', error);
            element.innerHTML = '<p style="color: red;">Error al renderizar el diagrama</p>';
        });
    }

    function filterActor(actor) {
        currentFilter = actor;

        // Actualizar botones activos
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        event.target.classList.add('active');

        // Renderizar diagrama filtrado
        renderDiagram(diagrams[actor]);
    }

    function zoomIn() {
        if (currentZoom < maxZoom) {
            currentZoom += zoomStep;
            updateZoom();
        }
    }

    function zoomOut() {
        if (currentZoom > minZoom) {
            currentZoom -= zoomStep;
            updateZoom();
        }
    }

    function resetZoom() {
        currentZoom = 1;
        updateZoom();
    }

    function updateZoom() {
        const wrapper = document.getElementById('diagramWrapper');
        wrapper.style.transform = `scale(${currentZoom})`;

        // Actualizar indicador
        document.getElementById('zoomIndicator').textContent = Math.round(currentZoom * 100) + '%';

        // Actualizar estado de botones
        document.getElementById('zoomOutBtn').disabled = currentZoom <= minZoom;
        document.getElementById('zoomInBtn').disabled = currentZoom >= maxZoom;
    }

    // Agregar zoom con rueda del mouse
    document.getElementById('diagramContainer').addEventListener('wheel', function(e) {
        if (e.ctrlKey || e.metaKey) {
            e.preventDefault();
            if (e.deltaY < 0) {
                zoomIn();
            } else {
                zoomOut();
            }
        }
    });

    // Renderizar diagrama inicial
    renderDiagram(diagrams.all);
    updateZoom();
</script>
</body>
</html>